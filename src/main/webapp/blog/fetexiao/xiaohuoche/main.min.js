var res={bg:"res/img/bg.png",car:"res/img/car.png",logobg:"res/img/logo2.png",superman:"res/img/logo3.png",title:"res/img/logo1.png",startBtn:"res/img/startBtn.png",wood:"res/img/b.png",beginTishi:"res/img/touch.png",hand:"res/img/hand.png",wing:"res/img/w.png",over:"res/img/over.png"},start_resources=[res.bg,res.car,res.logobg,res.superman,res.title,res.startBtn,res.wood,res.beginTishi,res.hand,res.wing,res.over];var LoaderScene=qc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"LoaderScene",timer:null,init:function(){var a=qc.director.getWinSize(),a=qc.p(a.width/2,a.height/2),b=this._label=qc.Label.create("Loading... 0%","Arial",24);b.setPosition(a);b.setColor(qc.color(180,180,180));this.addChild(this._label,10);return!0},onEnter:function(){qc.Node.prototype.onEnter.call(this);this._startLoading()},onExit:function(){qc.Node.prototype.onExit.call(this);this.timer&&clearInterval(this.timer)},
initWithResources:function(a,b){"string"==typeof a&&(a=[a]);this.resources=a||[];this.cb=b},_startLoading:function(){var a=this,b=a.resources;a._length=b.length;a._count=0;qc.loader.load(b,function(b,d){a._count=d},function(){a.cb&&a.cb()});this.timer=setInterval(function(){a._updatePercent()},0.1)},_updatePercent:function(){var a=this._count/this._length*100|0,a=Math.min(a,100);this._label.setString("Loading... "+a+"%")}});
LoaderScene.preload=function(a,b){this.loaderScene||(this.loaderScene=new LoaderScene,this.loaderScene.init());this.loaderScene.initWithResources(a,b);qc.director.runScene(this.loaderScene);return this.loaderScene};var GameStartLayer=qc.Layer.extend({winSize:null,middlePos:null,startBtn:null,frontLayer:null,init:function(){this._super();this.setPosition(0,0);this.winSize=qc.director.getWinSize();this.middlePos=qc.p(this.winSize.width/2,this.winSize.height/2);this.initBg();this.initHuoche();this.initFrontLayer();this.initLogo();this.initTitle();this.initBtn();this.addListener()},initBg:function(){var a=qc.Sprite.create(res.bg);this.addChild(a);a.setPosition(this.middlePos)},initHuoche:function(){var a=qc.Sprite.create(res.car);
this.addChild(a);a.setPosition(qc.p(this.middlePos.x,50))},initFrontLayer:function(){this.frontLayer=qc.Layer.create();this.addChild(this.frontLayer)},initLogo:function(){var a=qc.Sprite.create(res.logobg);this.frontLayer.addChild(a);a.setPosition(qc.p(this.middlePos.x,this.middlePos.y+90));var b=qc.RotateTo.create(1,360),c=qc.CallFunc.create(function(){a.setRotation(0)}),b=qc.Sequence.create([b,c]),b=qc.RepeatForever.create(b);a.runAction(b);b=qc.Sprite.create(res.superman);this.frontLayer.addChild(b);
b.setPosition(a.getPosition())},initTitle:function(){var a=qc.Sprite.create(res.title);this.frontLayer.addChild(a);a.setPosition(qc.p(this.middlePos.x,this.middlePos.y+20))},initBtn:function(){this.startBtn=qc.Sprite.create(res.startBtn);this.frontLayer.addChild(this.startBtn);this.startBtn.setPosition(qc.p(this.middlePos.x,80))},addListener:function(){qc.EventManager.addListener({event:qc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),
onTouchEnded:this.onTouchEnded.bind(this)},this)},startNextScene:function(){qc.director.runScene(new GameScene)},onTouchBegan:function(a,b){if(null!=this.startBtn){var c=a.getLocation();this.startBtn.isContain(c)&&this.startNextScene()}},onTouchMoved:function(a,b){},onTouchEnded:function(a,b){}}),GameStartScene=qc.Scene.extend({onEnter:function(){this._super();var a=new GameStartLayer;a.init();this.addChild(a)}});var HUOCHE_GAME_STATE={GAMEBEGIN:0,GAMEOVER:1,GAMEING:2},HUOCHE_GAME_TYPE={QUNARAPP:0,WX:1},GameLayer=qc.Layer.extend({winSize:null,middlePos:null,gameState:HUOCHE_GAME_STATE.GAMEBEGIN,frontLayer:null,huoche:null,bgLayer:null,woodLayer:null,timer:null,gameLevel:1,score:0,scoreLabel:null,hand:null,tishibegin:null,gameOverSprite:null,daojishi:null,gameType:HUOCHE_GAME_TYPE.QUNARAPP,init:function(){this._super();this.winSize=qc.director.getWinSize();this.middlePos=qc.p(this.winSize.width/2,this.winSize.height/
2);this.initGameState();this.initBg();this.initWood();this.initHuoche();this.frontLayer=qc.Layer.create();this.addChild(this.frontLayer);this.initBeginTiShi();this.initTimer();this.initDaojishi();this.initScore();this.initListener()},initGameState:function(){this.gameState=HUOCHE_GAME_STATE.GAMEBEGIN},initBg:function(){var a=this.bgLayer=BgMoveLayer.createWithBgAndSpeed(res.bg,0);this.addChild(a)},initHuoche:function(){var a=this.huoche=qc.Sprite.create(res.car);this.addChild(a);a.setPosition(qc.p(this.middlePos.x,
50))},initWood:function(){var a=this.woodLayer=new WoodMoveLayer(0,this);a.setPosition(qc.p(this.middlePos.x,this.middlePos.y-10));this.addChild(a)},huocheMove:function(){var a=qc.MoveBy.create(1,qc.p(0,-70));this.huoche.runAction(a)},initBeginTiShi:function(){var a=this.tishibegin=qc.Sprite.create(res.beginTishi),b=this.hand=qc.Sprite.create(res.hand);this.frontLayer.addChild(a);a.setPosition(qc.p(this.middlePos.x,this.middlePos.y+60));this.frontLayer.addChild(b);b.setPosition(qc.p(this.middlePos.x+
180,this.middlePos.y-60));this.handAction(b)},handAction:function(a){var b=qc.MoveBy.create(0.4,qc.p(-20,0)),c=qc.MoveBy.create(0.4,qc.p(20,0)),b=qc.Sequence.create([b,c]),b=qc.RepeatForever.create(b);a.runAction(b)},initTimer:function(){var a=this;this.timer=setInterval(function(){a.bgLayer.move();a.woodLayer.move()},1/60*1E3)},initDaojishi:function(){this.daojishi=Daojishi.create(60);this.daojishi.setPosition(qc.p(this.winSize.width-50,this.winSize.height-30));this.frontLayer.addChild(this.daojishi);
var a=this;this.daojishi.addEndListenner(function(){a.changeAndHandlerGameState(HUOCHE_GAME_STATE.GAMEOVER)})},initScore:function(){this.score=0;this.scoreLabel=qc.Label.create("",null,24);this.frontLayer.addChild(this.scoreLabel);this.updateScoreLabel(this.score)},changeSpeed:function(a){this.bgLayer.changeSpeed(a);this.woodLayer.changeSpeed(a);0==a&&this.timer&&(clearInterval(this.timer),this.timer=null)},onExit:function(){this._super();this.timer&&clearInterval(this.timer)},changeAndHandlerGameState:function(a){this.gameState=
a;this.handlerGameState()},handlerGameState:function(){switch(this.gameState){case HUOCHE_GAME_STATE.GAMEOVER:this.changeSpeed(0);this.stopDaojishi();this.showGameOver();break;case HUOCHE_GAME_STATE.GAMEING:this.handlerGameBegin()}},initListener:function(){qc.EventManager.addListener({event:qc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:null,onTouchEnded:this.onTouchEnded.bind(this)},this)},onTouchEnded:function(a,b){},onTouchBegan:function(a,
b){var c=a.getLocation();switch(this.gameState){case HUOCHE_GAME_STATE.GAMEBEGIN:this.checkBegin(c);break;case HUOCHE_GAME_STATE.GAMEING:this.checkGameing(c);break;case HUOCHE_GAME_STATE.GAMEOVER:this.checkPlayAgain(c)}},getOneScore:function(){this.score++;0==this.score%45&&(this.gameLevel++,this.changeSpeed(this.gameLevel+4));this.woodLayer.removeFirstWood();this.updateScoreLabel(this.score)},updateScoreLabel:function(a){a="\u5f97\u5206:"+a;this.scoreLabel.setString(a);a=qc.p(70-24*a.length/2,this.winSize.height-
30);this.scoreLabel.setPosition(a)},checkGameing:function(a){var b=this.woodLayer.getFirstWood();a=this.translateToLayer(a,this.woodLayer);b.isContain(a)?this.getOneScore():b.isElseContain(a)&&this.changeAndHandlerGameState(HUOCHE_GAME_STATE.GAMEOVER)},checkPlayAgain:function(a){a=qc.MoveTo.create(0.5,qc.p(3*this.middlePos.x,this.middlePos.y));var b=qc.CallFunc.create(function(){qc.director.runScene(new GameStartScene)});a=qc.Sequence.create([a,b]);this.gameOverSprite.runAction(a)},checkBegin:function(a){var b=
this.woodLayer.getFirstWood();a=this.translateToLayer(a,this.woodLayer);b.isContain(a)&&(this.changeAndHandlerGameState(HUOCHE_GAME_STATE.GAMEING),this.getOneScore())},handlerGameBegin:function(){var a=this.hand,b=this.tishibegin;a.stopAllActions();this.flyOut(a,500);this.flyOut(b,-300);this.changeSpeed(this.gameLevel+4);this.daojishi.beginTimer();this.huocheMove()},flyOut:function(a,b){var c=a.getPosition(),c=qc.MoveTo.create(0.2,qc.p(b,c.y)),d=qc.CallFunc.create(function(){a.removeFromParent()}),
c=qc.Sequence.create([c,d]);a.runAction(c)},translateToLayer:function(a,b){var c=b.getPosition();return qc.p(a.x-c.x,a.y-c.y)},showGameOver:function(){var a=this.gameOverSprite=qc.Sprite.create(res.over);this.addChild(a);a.setPosition(qc.p(-this.middlePos.x,this.middlePos.y));var b=qc.MoveTo.create(0.5,this.middlePos);a.runAction(b)},stopDaojishi:function(){this.daojishi.pauseTimer()}}),GameScene=qc.Scene.extend({onEnter:function(){this._super();var a=new GameLayer;a.init();this.addChild(a)}});
GameScene.create=function(a){};var BgMoveLayer=qc.Layer.extend({bgres:null,speed:2,fps:60,timer:null,init:function(){return this._super()?(this.initBg(),!0):!1},initWithBgAndSpeed:function(a,b,c){this.speed=b;this.bgres=a;this.fps=c||this.fps;this.init()},initBg:function(){for(var a=0;2>a;a++){var b=qc.Sprite.create(this.bgres),c=b.getTextureRect().height;b.setAnchorPoint(0,0);b.setPosition(qc.p(0,a*c));this.addChild(b)}},initSchedule:function(){var a=this;this.timer=setInterval(function(){a.move()},1/this.fps*1E3)},move:function(){for(var a=
this.getChildren(),b=a.length,c=0;c<b;c++){var d=a[c],e=d.getPosition(),f=d.getTextureRect().height;d.setPosition(qc.p(0,0>=e.y+f?e.y+f*b-this.speed:e.y-this.speed))}},onExit:function(){this._super();this.timer&&clearInterval(this.timer)},changeSpeed:function(a){qc.log("changeSpeed:"+a);this.speed=a}});BgMoveLayer.createWithBgAndSpeed=function(a,b,c){var d=new BgMoveLayer;d.initWithBgAndSpeed(a,b,c);return d};var WoodMoveLayer=qc.Layer.extend({woodLayer:null,speed:null,gameScene:null,moneyArray:[],purseNum:0,gameType:HUOCHE_GAME_TYPE.WX,totalWoodNum:160,nowNum:0,jiange:132,ctor:function(a,b,c){this._super();this.woodLayer=qc.Layer.create();this.speed=a;this.gameScene=b;this.init();this.initMoneyWithOption(c)},init:function(){for(var a=0;5>a;a++){var b;b=0==a?90:this.getPosxRandomDir();this.initOneMuTou(qc.p(b,a*this.jiange))}},initMoneyWithOption:function(a){a&&(this.gameType=a.gameType,this.moneyArray=
a.moneyArray,this.purseNum=a.purseNum)},move:function(){for(var a=this.getChildren(),b=a.length,c=0;c<b;c++){var d=a[c];if(!d.getUserData()){var e=d.getPosition(),e=qc.p(e.x,e.y-this.speed);-200>e.y&&this.sendGameOver();d.setPosition(e)}}},createNewWood:function(){var a=this.getChildren(),a=a[a.length-1].getPosition();this.initOneMuTou(qc.p(this.getPosxRandomDir(),a.y+this.jiange))},initOneMuTou:function(a){var b=a.y;a=WoodSprite.createWithPosx(a.x);this.addChild(a);a.setPosition(qc.p(0,b))},getPosxRandomDir:function(){var a=
Math.floor(3*Math.random());return 0==a?90:1==a?-90:0},getFirstWood:function(){for(var a=this.getChildren(),b=a.length,c=0;c<b;c++){var d=a[c];if(!d.getUserData())return d}},removeFirstWood:function(){var a=this.getFirstWood();a.setUserData(1);this.flyOut(a.wood,a);this.createNewWood()},flyOut:function(a,b){var c=a.getPosition(),d=qc.RotateTo.create(0.3,135),c=qc.MoveBy.create(0.5,qc.p(-500,c.y)),e=qc.CallFunc.create(function(){b?b.removeFromParent():a.removeFromParent()}),c=qc.Sequence.create([c,
e]);a.runAction(d);a.runAction(c)},sendGameOver:function(){this.gameScene.changeAndHandlerGameState(HUOCHE_GAME_STATE.GAMEOVER)},changeSpeed:function(a){this.speed=a}});var Daojishi=qc.Layer.extend({timeshow:0,timeLabel:null,timer:null,listeners:null,_isPause:!1,beginTimer:function(){this.timer&&(clearInterval(this.timer),this.timer=null);var a=this;this.timer=setInterval(function(){a.updateTimeShow()},1E3);this._isPause=!1},pauseTimer:function(){this.timer&&(clearInterval(this.timer),this.timer=null);this._isPause=!0},resetTimer:function(){},addEndListenner:function(a){this.listeners.push(a)},removeEndListenner:function(a){a=this.listeners;for(var b=a.length,c=
0;c<b;c++)a[c]&&(a.splice(c,1),c--)},triger:function(){for(var a=this.listeners,b=a.length,c=0;c<b;c++)(0,a[c])()},init:function(){this.listeners=[];this.timeLabel=qc.Label.create(this.timeshow,null,"30");this.timeLabel.setColor(qc.color(255,0,0));this.timeLabel.setPosition(qc.p(-30*(this.timeshow+"").length/2,0));this.addChild(this.timeLabel)},initWithTime:function(a){this.timeshow=a;this.init()},updateTimeShow:function(a){this._isPause||(a?this.timeshow=a:0<this.timeshow&&this.timeshow--,this.updateTimeLabel(),
0==this.timeshow&&(this.triger(),this.pauseTimer()))},updateTimeLabel:function(){this.timeLabel.setString(this.timeshow)}});Daojishi.create=function(a){var b=new Daojishi;b.initWithTime(a);return b};var WOODTYPE={WOOD:0,GOLD:1,PURSE:2},WoodSprite=qc.Layer.extend({wood:null,posx:0,type:WOODTYPE.WOOD,money:0,initWithPosx:function(a,b,c){this.posx=a;this.type=b||WOODTYPE.WOOD;this.money=c||0;b=this.getResByType(this.type);this.wood=qc.Sprite.create(b);this.wood.setPosition(qc.p(a,0));this.addChild(this.wood)},getResByType:function(a){var b=res.wood;switch(a){case WOODTYPE.WOOD:b=res.wood}return b},isContain:function(a){a=this.translateToLayer(a,this);var b=this.wood.getPosition();return 90>a.y&&
-66<a.y&&a.x>b.x-60&&a.x<b.x+60},isElseContain:function(a){a=this.translateToLayer(a,this);return 39>a.y&&-39<a.y?(this.setWingFlag(qc.p(-45>a.x?-90:45<a.x?90:0,30)),!0):!1},setWingFlag:function(a){var b=qc.Sprite.create(res.wing);b.setPosition(a);this.addChild(b)},translateToLayer:function(a){var b=this.getPosition();return qc.p(a.x-b.x,a.y-b.y)}});WoodSprite.createWithPosx=function(a){var b=new WoodSprite;b.initWithPosx(a);return b};
WoodSprite.createWithPosxAndType=function(a,b,c){var d=new WoodSprite;d.initWithPosx(a,b,c);return d};qc.game.onStart=function(){LoaderScene.preload(start_resources,function(){var a=new GameStartScene;qc.director.runScene(a)})};qc.game.run();